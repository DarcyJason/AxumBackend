{"schemas":"DEFINE TABLE OVERWRITE audit_log SCHEMALESS;\n\n# DEFINE FIELD OVERWRITE field ON audit_log;\nDEFINE TABLE OVERWRITE device SCHEMALESS;\n\n# DEFINE FIELD OVERWRITE field ON device;\nDEFINE TABLE OVERWRITE refresh_token SCHEMALESS;\n\n# DEFINE FIELD OVERWRITE field ON refresh_token;\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\nDEFINE TABLE OVERWRITE user SCHEMAFULL\nPERMISSIONS\n    FOR create\n        WHERE $auth != NONE\n    FOR select\n        WHERE $auth.role in [\"Admin\", \"SystemOwner\"]\n        OR id == $auth.id\n    FOR update\n        WHERE $auth.role == \"SystemOwner\"\n        OR (\n            $auth.role == \"Admin\"\n            AND role != \"SystemOwner\"\n            AND id == $auth.id\n        )\n    FOR delete\n        WHERE $auth.role == \"SystemOwner\"\n        OR ($auth.role == \"Admin\" AND role != \"SystemOwner\");\n\nDEFINE FIELD OVERWRITE name ON user TYPE string ASSERT\n    {\n        IF string::len($value) > 2 && string::len($value) < 20 {\n            RETURN true\n        } ELSE {\n            THROW \"Name length must be between 3 and 20 characters\"\n        }\n    };\nDEFINE FIELD OVERWRITE email ON user TYPE string ASSERT\n    {\n        IF string::is::email($value) {\n            RETURN true\n        } ELSE {\n            THROW \"Invalid email format\"\n        }\n    };\nDEFINE FIELD OVERWRITE password_hashed ON user TYPE string ASSERT\n    {\n        IF string::len($value) > 0 {\n            RETURN true\n        } ELSE {\n            THROW \"Password hash cannot be empty\"\n        }\n    };\nDEFINE FIELD OVERWRITE role ON user TYPE string ASSERT\n    {\n        IF $value IN [\"User\", \"Admin\", \"SystemOwner\"] {\n            RETURN true\n        } ELSE {\n            THROW \"Invalid role value\"\n        }\n    }\n    PERMISSIONS FOR update WHERE $auth.role = \"SystemOwner\";\nDEFINE FIELD OVERWRITE is_verified ON user TYPE bool DEFAULT false;\nDEFINE FIELD OVERWRITE is_banned ON user TYPE bool DEFAULT false;\nDEFINE FIELD OVERWRITE created_at ON user TYPE datetime DEFAULT time::now() READONLY;\nDEFINE FIELD OVERWRITE updated_at ON user TYPE datetime DEFAULT time::now();\n\n\nDEFINE INDEX OVERWRITE idx_user_email ON user FIELDS email UNIQUE;\nDEFINE INDEX OVERWRITE idx_user_role ON user FIELDS role;\nDEFINE INDEX OVERWRITE idx_user_is_banned ON user FIELDS is_banned;\nDEFINE INDEX OVERWRITE idx_user_created_at ON user FIELDS created_at;\n","events":""}